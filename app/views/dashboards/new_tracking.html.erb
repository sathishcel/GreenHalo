

<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-10">
    <h2>Tracking</h2>
    <ol class="breadcrumb">
      <li>
        <a href="<%= url_for :controller => 'dashboards', :action => 'dashboard_2' %>">Home</a>
      </li>
      <li class="active">
        <strong>Tracking</strong>
      </li>
    </ol>
  </div>
  <div class="col-lg-2">

  </div>
</div>


<div class="wrapper wrapper-content animated fadeInRight">
  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-title">
          <h5>Waste Generating Units</h5>
        </div>
        <div class="ibox-content">
          <div class="">
            <a class="btn btn-primary " id = "add_wgu_button" >Add WGU</a>
            <a class="btn btn-primary " id = "add_level_button">Add Level</a>
            <a class="btn btn-primary " href="javascript:void(0);" onclick="">Expand All</a>
            <a class="btn btn-primary " href="javascript:void(0);" onclick="">Collapse All</a>
          </div>

          <div id = "add_wgu_popup" style = "display:none;">
             <p>Hello World</p>
          </div>

          <div id = "add_level_popup" style = "display:none;">
            <div id="vendor_selection" >
              <%= select_tag "multi_level_selection", options_for_select(1..10, :selected => 1),
                             :'data-remote' => 'true',
                             :'data-url' => url_for(:controller => 'dashboards', :action => 'new_tracking'),:style => "width:17%;height:10%; margin-right: 25px;" %>

            </div>
            <div id="multi_level_loading_div">

            <%= form_tag "/levels", :method => :post do %>
                <ol >
                  <% for i in 1 .. @wgu_limit %>
                      <li>
                        <%= text_field_tag "level[#{i}][name]", "", :placeholder => "Enter Level Name",
                                           :style => "border-radius: 5px;border: #C9C9C9 1px solid;width: 47%;height:25%;padding: 2px 5px;font-size: 13px;" %>
                        <%= select_tag "level[#{i}][level_id]", options_for_select(Level.all.map{|i| [i.name,i.id]}),
                               :class => "wgu_vend_select", :style => "height:25%", :prompt => @all_levels.blank? ? "Select Level" : "Assign as SubLevel To" %>
                      </li>
                  <%end%>
                  <%= submit_tag "ADD LEVEL", :class => "button", :style => "float:right;margin-right: 20px;" %>
                </ol>
            <%end%>

            </div>

          </div>



          <table class="table table-striped table-bordered table-hover dataTables-example">
            <thead>
            <tr>
              <th>Menu</th>
              <th>Name, Address, City, State, Zip, Tracking #</th>
              <th>#of Units</th>
              <th>Tons Disposed</th>
              <th>Tons Recycled</th>
              <th>Recycling Rate</th>
              <th>Disposal Costs</th>
              <th>Return on Recycling</th>
            </tr>
            </thead>

            <tbody class = "table_order">
            <% @all_levels.each do |level| %>

                <tr class="gradeX wt-trho" id = "sub_level_<%= level.id %>" value = "<%= level.id %>" >
                  <td>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                      <i class="fa fa-list"></i>
                    </a>

                    <ul class="dropdown-menu dropdown-user" style="left:auto; top:auto;">
                      <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="reports.html">
                          <div>View Reports</div>
                        </a>
                      </li>

                      <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="messages.html">
                          <div>Messages</div>
                        </a>
                      </li>
                      <li role="presentation">
                        <a href="#"  role="menuitem" tabindex="-1" data-toggle="modal" data-target="#myModal15" title="Settings">
                          <div>Level Settings</div>
                        </a>
                      </li>
                      <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="manage-portal.html">
                          <div>Manage Portal</div>
                        </a>
                      </li>
                      <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#">
                          <div>API</div>
                          <div style="color:#999999; font-size:10px;">
                        </a>
                      </li>
                      <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#">
                          <div>Add Level</div>
                        </a>
                      </li>
                      <li role="presentation" class="divider"></li>
                      <li role="presentation">
                        <a role="menuitem" class="addwgu" tabindex="-1" href="#" style="color:#058F26;">
                          Add New Waste Generating Unit
                        </a>
                      </li>
                      <li role="presentation">
                        <a role="menuitem" tabindex="-1" href="#" style="color:#FF0707;">
                          Delete This WGU
                        </a>
                      </li>
                    </ul>
                  </td>

                  <td><%= level.name %></td>
                  <td>
                    Internet
                    Explorer 4.0
                  </td>
                  <td>Win 95+</td>
                  <td class="center">4</td>
                  <td class="center">X</td>
                  <td class="center">X</td>
                  <td class="center">X</td>
                </tr>




            <%end%>

            </tbody>
          </table>

        </div>
      </div>
    </div>
  </div>
</div>


<%= render partial: "level_setttings_base_page"%>

<script>
    $(document).ready(function(){
        $('.dataTables-example').DataTable({
            dom: '<"html5buttons"B>lTfgitp',
            buttons: [
                { extend: 'copy'},
                {extend: 'csv'},
                {extend: 'excel', title: 'ExampleFile'},
                {extend: 'pdf', title: 'ExampleFile'},

                {extend: 'print',
                    customize: function (win){
                        $(win.document.body).addClass('white-bg');
                        $(win.document.body).css('font-size', '10px');

                        $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                    }
                }
            ]

        });

        /* Init DataTables */
   /*     var oTable = $('#editable').DataTable();

        /* Apply the jEditable handlers to the table */
    /*    oTable.$('td').editable( '../example_ajax.php', {
            "callback": function( sValue, y ) {
                var aPos = oTable.fnGetPosition( this );
                oTable.fnUpdate( sValue, aPos[0], aPos[1] );
            },
            "submitdata": function ( value, settings ) {
                return {
                    "row_id": this.parentNode.getAttribute('id'),
                    "column": oTable.fnGetPosition( this )[2]
                };
            },

            "width": "90%",
            "height": "100%"
        } );


    }); */

    function fnClickAddRow() {
        $('#editable').dataTable().fnAddData( [
            "Custom row",
            "New row",
            "New row",
            "New row",
            "New row" ] );

    }
</script>

<style>
    #add_wgu_popup{
        background-color: #fff;
        position: absolute;
        z-index: 10;
        padding: 10px 5px;
        border: #C9C9C9 1px solid;
        margin-top: -5px;
        border-radius: 8px;
    }
    #add_level_popup{
        background-color: #fff;
        position: absolute;
        z-index: 10;
        padding: 10px 5px;
        border: #C9C9C9 1px solid;
        margin-top: -5px;
        border-radius: 8px;
        margin-left: 10%;
    }
</style>



<script>
  $(document).ready(function(){
     $(".table_order tr").click(function(e){
         if ($(e.target).closest('.dropdown-toggle').length === 0 && $(e.target).closest('.dropdown-user').length === 0 ) {
             var level_id = $(this).attr('value');
             var url = "/getting_sub_levels/" + level_id;
             $.ajax({
                 type: "GET",
                 url: url
             });

         }
     });

      $(document).on('click', function(e) {
          var elem = $(e.target).closest('#add_wgu_button'),
                  box  = $(e.target).closest('#add_wgu_popup');

          if ( elem.length ) {
              e.preventDefault();
              $('#add_wgu_popup').toggle();
          }else if (!box.length){
              $('#add_wgu_popup').hide();
          }
      });

      $(document).on('click', function(e) {
          var elem = $(e.target).closest('#add_level_button'),
                  box  = $(e.target).closest('#add_level_popup');

          if ( elem.length ) {
              e.preventDefault();
              $('#add_level_popup').toggle();
          }else if (!box.length){
              $('#add_level_popup').hide();
          }
      });
  });
</script>

<style>
  .wt-trho:hover{
      background-color: #cccccc !important;
  }
</style>
